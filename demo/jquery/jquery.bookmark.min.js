(function(a){a.fn.bookmark=function(k){var c={storageName:"ditt.to.bookmarks",perPage:10,sort:"date",buttonCallback:"",deleteCallback:"",parentNode:"head",titleNode:'meta[property="og:title"]',urlNode:'meta[property="og:url"]',imageNode:'meta[property="og:image"]',attributeName:"content",defaultImage:"default.png",extraVars:{},listTemplate:'<div class="bookmark"><a href="%url%" title="%title%"><img src="%image%" title="%title%"/></a><a class="bookmark-title" href="%url%" title="%title%">%title% - %price%</a>%desc%<span class="bookmark-delete" data-url="%url%">Delete</span></div>'};k=a.extend({},c,k);var j=a(this);if(!localStorage){return null}function e(l){a(l).bind("click.bookmark",function(){var o={};o.date=new Date().getTime();o.title=a(this).closest(k.parentNode).find(k.titleNode).attr(k.attributeName);o.title=o.title?o.title:a("title").html();o.url=a(this).closest(k.parentNode).find(k.urlNode).attr(k.attributeName);o.url=o.url?o.url:window.location.href;o.url=o.url.replace(/#$/,"");o.image=a(this).closest(k.parentNode).find(k.imageNode).attr(k.attributeName);o.image=o.image?o.image:a(this).closest(k.parentNode).find("img").attr("src");o.image=typeof o.image!=="undefined"?o.image:null;for(var m in k.extraVars){var n=a(this).closest(k.parentNode).find(k.extraVars[m]).attr(k.attributeName);o[m]=n?n:""}g(o);if(k.buttonCallback){k.buttonCallback(this,o)}a(this).unbind("click.bookmark");return false});a(l).show();return true}function g(o){var p=i();var n=f(p,o.url);var l=[];l.push(o);for(var m=0;m<p.length;m++){if(p[m].url!=o.url){l.push(p[m])}}localStorage.setItem(k.storageName,JSON.stringify(l))}function d(l){var m=i();var n=[];for(key in m){if(m[key].url!=l&&(typeof m[key].url!="undefined"&&l!="undefined")){n.push(m[key])}}localStorage.setItem(k.storageName,JSON.stringify(n))}function i(){var l=JSON.parse(localStorage.getItem(k.storageName));if(!l){l=[]}return l}function f(n,m){if(!n){n=i()}var l=false;for(key in n){if(n[key].url==m){l=true}}return l}function h(o,q,p){q=q?q:0;p=p?p:500;var n=i();q=q<n.length?q:n.length;p=p+q<n.length?p+q:n.length;var v=[];for(var r=q;r<p;r++){if(n[r]){v.push(n[r])}}n=v;for(var s=0;s<n.length;s++){n[s].image=n[s].image!=null?n[s].image:k.defaultImage;var w=k.listTemplate.replace(/\%url\%/g,n[s].url).replace(/\%image\%/g,n[s].image);w=w.replace(/\%title\%/g,n[s].title);for(var l in k.extraVars){w=w.replace(new RegExp("%"+l+"%","g"),typeof n[s][l]!="undefined"?n[s][l]:"")}var t=a(w);o.append(t)}var u=a.data(o.get(0),"events");var m=false;if(u){for(s in u.click){if(u.click[s].namespace=="delete-bookmark"){m=true}}}if(!m){o.on("click.delete-bookmark",".bookmark-delete",function(){d(a(this).attr("data-url"));o.empty();if(k.deleteCallback){k.deleteCallback(this,data)}h(o)})}}function b(){var l=i();return l.length}return{initButtons:function(){j.each(function(l,m){e(m)})},list:function(m,n,l){h(a(m),n,l)},count:function(){return b()},isBookmarked:function(){return f(null,a('meta[property="og:url"]').attr("content"))}}}})(jQuery);